'use strict';

var usersDao = require('../../dao/users');

var logRequest = function(req,callbk){
    console.log(req);
    var accessData = {};
    accessData.user_token = req.access_token;
    accessData.product_id = req.productId;
    accessData.user_id = req.user_id;
    accessData.req_url = req._parsedUrl.pathname;
    accessData.req_body = req.body?JSON.stringify(req.body):null;
    accessData.req_query = req.query?JSON.stringify(req.query):null;
    accessData.http_method = req.method;
    accessData.accessed_on = new Date;
    
    usersDao.saveAccessLogData(accessData,function(err,data){
        callbk();
    });
    
}

module.exports = function () {
    return function (req, res, next) {
        console.log('in logging interceptor');
        logRequest(req,function(err){
            if(err){
                res.json({error: err});
            } else{
                next();   
            }
        });    

    };
};